# ADR: Сравнение RabbitMQ и Kafka для системы мониторинга

## Критерии сравнения
1. Производительность и масштабируемость
2. Надёжность доставки сообщений
3. Простота эксплуатации и внедрения
4. Интеграция с IoT (MQTT)
5. Поддержка потоковой аналитики
6. Гибкость маршрутизации сообщений
7. Требования к инфраструктуре
8. Поддержка отказоустойчивости и кластеризации
9. Стоимость владения и сопровождения
10. Сообщество и поддержка

## Анализ вариантов по критериям

| Критерий                        | RabbitMQ                                      | Kafka                                         |
|----------------------------------|------------------------------------------------|-----------------------------------------------|
| Производительность, масштабируемость | Хорошо для средних нагрузок, до десятков тысяч сообщений/сек | Отлично для высоких нагрузок, масштабируется горизонтально |
| Надёжность доставки              | Гарантированная доставка (ack, retry, DLQ)     | Гарантированная доставка (commit log, replay) |
| Простота эксплуатации            | Прост в установке и поддержке, много GUI       | Сложнее в установке, требует настройки ZooKeeper (или KRaft) |
| Интеграция с IoT (MQTT)          | Прямая поддержка MQTT                          | Нет нативной поддержки MQTT                   |
| Потоковая аналитика              | Ограничена, требует внешних инструментов       | Встроенная (Kafka Streams, ksqlDB)            |
| Гибкость маршрутизации           | Exchange/queue, поддержка pub/sub и point-to-point | Pub/sub, partitioning, consumer groups        |
| Требования к инфраструктуре      | Минимальные, подходит для небольших серверов   | Требует больше ресурсов, дисков, памяти       |
| Отказоустойчивость, кластеризация| Поддерживается, но сложнее, чем у Kafka        | Встроенная, легко масштабируется              |
| Стоимость владения               | Ниже, проще DevOps, меньше ресурсов            | Выше, требует больше DevOps и ресурсов        |
| Сообщество и поддержка           | Большое, зрелое, много примеров                | Очень большое, особенно для Big Data          |

## Резюме и рекомендация

Для MVP и пилотного внедрения системы мониторинга, где важны простота эксплуатации, интеграция с IoT (MQTT), минимальные требования к инфраструктуре и быстрая реализация, **рекомендуется использовать RabbitMQ** как основную очередь сообщений.

RabbitMQ обеспечивает все необходимые возможности для обмена сообщениями, интеграции с IoT-устройствами и надёжной доставки событий и команд. При этом он проще в эксплуатации и требует меньше ресурсов, что важно для старта проекта.

**Kafka** рекомендуется рассматривать только при существенном росте нагрузки, необходимости потоковой аналитики в реальном времени и масштабировании системы до уровня крупного SaaS или агрохолдинга.

**Итог:**
- Рекомендуемое решение: **RabbitMQ**
- Kafka — альтернатива для будущего масштабирования и Big Data. 